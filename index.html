
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Live Match ‚Äì DEBUG build</title>
<script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  :root{ --a:#2f7d32; --b:#256b2b; --overlay:rgba(0,0,0,.22); }
  body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f3f7f3}
  .wrap{max-width:900px;margin:0 auto;padding:12px}
  .panel{background:#fff;border-radius:14px;box-shadow:0 6px 20px rgba(0,0,0,.08);padding:12px;margin-bottom:12px}
  button{border-radius:10px;border:1px solid #ddd;padding:8px 10px;background:#f8f8f8}
  button.primary{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
  #capture{position:relative;border-radius:16px;overflow:hidden;aspect-ratio:3/4}
  #bg{position:absolute;inset:0}
  #header{position:absolute;left:0;right:0;top:0;padding:8px}
  .bar{background:var(--overlay);color:#fff;border-radius:12px;padding:8px;display:flex;justify-content:space-between;align-items:center;gap:8px}
  .cols{position:absolute;left:0;right:0;bottom:0;top:90px;padding:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .col{overflow:auto}
  .evt{color:#fff;border-bottom:1px solid rgba(255,255,255,.12);padding:6px 2px;font-size:15px;display:flex;gap:8px;align-items:center}
  .muted{opacity:.85}
  #err{position:fixed;left:8px;right:8px;bottom:8px;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;border-radius:10px;padding:8px;display:none;z-index:9999;white-space:pre-wrap}
  #log{font-family:ui-monospace,Menlo,monospace;font-size:12px;max-height:40vh;overflow:auto}
  .clock{font:12px ui-monospace,Menlo,monospace}
  .big{font-weight:800;font-size:28px}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel">
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button id="homeGoal">‚öΩÔ∏è Domicile</button>
      <button id="awayGoal">‚öΩÔ∏è Visiteur</button>
      <button id="half">‚è±Ô∏è Mi-temps</button>
      <button id="resume">‚ñ∂Ô∏è Reprise</button>
      <button id="final" class="primary">üèÅ Fin</button>
      <button id="undo">‚Ü©Ô∏è Annuler</button>
      <button id="export">üì§ Export</button>
      <span class="clock">Horloge: <span id="clk">00:00</span></span>
      <button id="start">‚ñ∂Ô∏è</button>
      <button id="pause">‚è∏Ô∏è</button>
      <button id="reset">‚ü≤</button>
      <button id="selftest">üß™ Self‚Äëtest</button>
    </div>
  </div>

  <div id="capture" class="panel" style="padding:0">
    <svg id="bg" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
      <defs><pattern id="s" width="1" height="84" patternUnits="userSpaceOnUse">
        <rect x="0" y="0" width="100%" height="42" fill="var(--a)"/>
        <rect x="0" y="42" width="100%" height="42" fill="var(--b)"/>
      </pattern></defs>
      <rect x="0" y="0" width="100%" height="100%" fill="url(#s)"/>
    </svg>

    <div id="header">
      <div class="bar">
        <div>üè† <span id="homeName">Domicile</span></div>
        <div style="text-align:center">
          <div class="big" id="score">0 ‚Äì 0</div>
          <div class="clock"><span id="clk2">00:00</span></div>
        </div>
        <div>üõ´ <span id="awayName">Visiteur</span></div>
      </div>
    </div>

    <div class="cols">
      <div id="left" class="col"></div>
      <div id="right" class="col"></div>
    </div>
  </div>

  <div id="err">
    <div><strong>Erreur JavaScript d√©tect√©e</strong> (copiable si besoin)</div>
    <div id="log"></div>
  </div>
</div>

<script>
  // --- error overlay ---
  function showErr(msg){
    const box = document.getElementById('err');
    const log = document.getElementById('log');
    log.textContent += msg + "\n";
    box.style.display = 'block';
  }
  window.onerror = function(message, source, lineno, colno, error){
    showErr(message + " @" + lineno + ":" + colno);
  };
  window.onunhandledrejection = function(e){
    showErr("Promise rejection: " + (e.reason && e.reason.message ? e.reason.message : e.reason));
  };

  // --- state ---
  const st = {
    home:0, away:0, events:[], hist:[],
    clock:{run:false, start:0, elapsed:0}
  };
  function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }

  // --- helpers ---
  const $ = (id)=>document.getElementById(id);
  function render(){
    $('score').textContent = st.home + " ‚Äì " + st.away;
    $('left').innerHTML = "";
    $('right').innerHTML = "";
    st.events.forEach(e=>{
      const nL = document.createElement('div'); nL.className='evt'+(e.team?'':' muted');
      const nR = document.createElement('div'); nR.className='evt'+(e.team?'':' muted');
      const minute = (e.type==='FT') ? '' : (typeof e.minute==='number' ? (e.minute + "' ") : '');
      const txt = minute + e.icon + " " + (e.label||"");
      nL.textContent = txt; nR.textContent = txt;
      if(e.team==='HOME') $('left').appendChild(nL);
      else if(e.team==='AWAY') $('right').appendChild(nR);
      else { $('left').appendChild(nL); $('right').appendChild(nR); }
    });
  }
  function push(ev){ st.hist.push(JSON.stringify(st)); st.events.push(ev); render(); }
  function nowMin(){ const base = st.clock.elapsed + (st.clock.run ? (Date.now()-st.clock.start) : 0); return Math.floor(base/60000); }

  // --- buttons ---
  $('homeGoal').onclick = ()=>{ push({id:uid(), team:'HOME', type:'GOAL', icon:'‚öΩÔ∏è', label:'But', minute: nowMin()}); st.home++; render(); };
  $('awayGoal').onclick = ()=>{ push({id:uid(), team:'AWAY', type:'GOAL', icon:'‚öΩÔ∏è', label:'But', minute: nowMin()}); st.away++; render(); };
  $('half').onclick     = ()=>{ push({id:uid(), team:null, type:'HT',   icon:'‚è±Ô∏è', label:'Mi-temps', minute: nowMin()}); };
  $('resume').onclick   = ()=>{ /* just hides banner in full app */ };
  $('final').onclick    = ()=>{ push({id:uid(), team:null, type:'FT',   icon:'üèÅ', label:'Fin de match', minute: null}); };
  $('undo').onclick     = ()=>{ if(!st.hist.length) return; Object.assign(st, JSON.parse(st.hist.pop())); render(); };

  $('export').onclick = async ()=>{
    const el = $('capture');
    const can = await html2canvas(el, {backgroundColor:'#2f7d32', scale:2});
    const blob = await new Promise(r=>can.toBlob(r,'image/png'));
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='match.png'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url), 1000);
  };

  // --- clock ---
  $('start').onclick=()=>{ if(!st.clock.run){ st.clock.run=true; st.clock.start=Date.now(); } };
  $('pause').onclick=()=>{ if(st.clock.run){ st.clock.elapsed += Date.now()-st.clock.start; st.clock.run=false; } };
  $('reset').onclick=()=>{ st.clock.run=false; st.clock.elapsed=0; st.clock.start=0; };
  (function tick(){
    const ms = st.clock.elapsed + (st.clock.run ? (Date.now()-st.clock.start) : 0);
    const m = Math.floor(ms/60000), s = Math.floor((ms%60000)/1000);
    const v = (m<10?'0':'')+m+":"+(s<10?'0':'')+s;
    $('clk').textContent = v; $('clk2').textContent = v;
    requestAnimationFrame(tick);
  })();

  // --- self test ---
  $('selftest').onclick = ()=>{
    try{
      $('homeGoal').click();
      $('awayGoal').click();
      $('half').click();
      $('final').click();
    }catch(e){ showErr("Self-test fail: "+e.message); }
  };

  render();
</script>
</body>
</html>
